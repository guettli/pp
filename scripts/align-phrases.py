#!/usr/bin/env python3
"""
Align phrases across all 3 language files (phrases-de-DE.yaml, phrases-en-GB.yaml, phrases-fr-FR.yaml).

1. Fixes wrong â“ emoji assignments in phrases-en-GB.yaml
2. Adds missing translations for each language
3. Uses espeak-ng for IPA generation (de, fr, en-gb)
"""

import subprocess
import sys
from pathlib import Path

import yaml

REPO_ROOT = Path(__file__).parent.parent


def get_espeak_ipa(text: str, lang_code: str) -> str:
    """Get IPA from espeak-ng. lang_code: 'de', 'fr', 'en-gb'"""
    result = subprocess.run(
        ["espeak-ng", "-v", lang_code, "--ipa", "-q", text],
        capture_output=True,
        text=True,
    )
    return result.stdout.strip()


def load_yaml(path: Path) -> list:
    with open(path, encoding="utf-8") as f:
        return yaml.safe_load(f)


def save_yaml(path: Path, data: list) -> None:
    with open(path, "w", encoding="utf-8") as f:
        yaml.dump(data, f, default_flow_style=False, allow_unicode=True, sort_keys=False, width=120)


# ---------------------------------------------------------------------------
# Step 1: Fix wrong â“ emoji assignments in phrases-en-GB.yaml
# These phrases exist in EN but have the wrong emoji (â“ placeholder)
# ---------------------------------------------------------------------------
EMOJI_FIXES = {
    "arts": "ğŸ¨",
    "balloon": "ğŸˆ",
    "bamboo": "ğŸ‹",
    "bright": "ğŸ”†",
    "diamond": "ğŸ’",
    "dim": "ğŸ”…",
    "globe": "ğŸŒ",
    "lift": "ğŸ›—",
    "mate": "ğŸ¤",
    "mountain": "ğŸ”ï¸",
    "sofa": "ğŸ›‹ï¸",
    "wrestle": "ğŸ¤¼",
    # "question" intentionally keeps â“
}


# ---------------------------------------------------------------------------
# Step 2: New German phrases to add
# Format: (phrase, emoji)  â€” IPA will be generated by espeak-ng
# ---------------------------------------------------------------------------
NEW_DE = [
    # DE+EN-not-FR: already in DE, but adding here would be duplicates â€” skip.
    # EN-only â†’ need DE translations:
    ("Null", "0ï¸âƒ£"),
    ("Die Tastatur", "âŒ¨ï¸"),
    ("Der Schneemann", "â˜ƒï¸"),
    ("Der Komet", "â˜„ï¸"),
    ("Der Klee", "â˜˜ï¸"),
    ("Frieden", "â˜®ï¸"),
    ("Krebs", "â™‹"),
    ("Der Anker", "âš“"),
    ("Die Waage", "âš–ï¸"),
    ("Das Zahnrad", "âš™ï¸"),
    ("Das Atom", "âš›ï¸"),
    ("Die Warnung", "âš ï¸"),
    ("Der Sarg", "âš°ï¸"),
    ("Das Gewitter", "â›ˆï¸"),
    ("Die Spitzhacke", "â›ï¸"),
    ("Die Kette", "â›“ï¸"),
    ("Kein Zutritt", "â›”"),
    ("Der Sonnenschirm", "â›±ï¸"),
    ("Der Brunnen", "â›²"),
    ("Die FÃ¤hre", "â›´ï¸"),
    ("Der Kraftstoff", "â›½"),
    ("Die Schere", "âœ‚ï¸"),
    ("Das HÃ¤kchen", "âœ…"),
    ("Sieg", "âœŒï¸"),
    ("Schreiben", "âœï¸"),
    ("Das Kreuz", "âœï¸"),
    ("Funkeln", "âœ¨"),
    ("Die Frage", "â“"),
    ("Der Kreis", "â­•"),
    ("Cool", "ğŸ†’"),
    ("Kostenlos", "ğŸ†“"),
    ("Neu", "ğŸ†•"),
    ("Oben", "ğŸ†™"),
    ("Service", "ğŸˆ‚ï¸"),
    ("Reserviert", "ğŸˆ¯"),
    ("Bestanden", "ğŸˆ´"),
    ("Voll", "ğŸˆµ"),
    ("Akzeptiert", "ğŸ‰‘"),
    ("Der Wirbelsturm", "ğŸŒ€"),
    ("Der Blitz", "ğŸŒ©ï¸"),
    ("Der Tornado", "ğŸŒªï¸"),
    ("Die Kastanie", "ğŸŒ°"),
    ("Der Kaktus", "ğŸŒµ"),
    ("Die Chilischote", "ğŸŒ¶ï¸"),
    ("Der Mais", "ğŸŒ½"),
    ("Das Getreide", "ğŸŒ¾"),
    ("Das Kraut", "ğŸŒ¿"),
    ("Die Melone", "ğŸˆ"),
    ("Die Ananas", "ğŸ"),
    ("Der Pfirsich", "ğŸ‘"),
    ("Das ReisbÃ¤llchen", "ğŸ™"),
    ("Das Curry", "ğŸ›"),
    ("Die Garnele", "ğŸ¤"),
    ("Das Eis", "ğŸ§"),
    ("Der Pudding", "ğŸ®"),
    ("Der Wein", "ğŸ·"),
    ("Der Cocktail", "ğŸ¸"),
    ("Die Babyflasche", "ğŸ¼"),
    ("Die Party", "ğŸ‰"),
    ("Das Konfetti", "ğŸŠ"),
    ("Die Puppen", "ğŸ"),
    ("Der Karpfen", "ğŸ"),
    ("Das Windspiel", "ğŸ"),
    ("Das Mikrofon", "ğŸ™ï¸"),
    ("Der Film", "ğŸï¸"),
    ("Das Riesenrad", "ğŸ¡"),
    ("Die Achterbahn", "ğŸ¢"),
    ("Das Kino", "ğŸ¦"),
    ("Der Zirkus", "ğŸª"),
    ("Das Spiel", "ğŸ®"),
    ("Billard", "ğŸ±"),
    ("Der WÃ¼rfel", "ğŸ²"),
    ("Die Note", "ğŸµ"),
    ("Das Saxofon", "ğŸ·"),
    ("Die Partitur", "ğŸ¼"),
    ("Das Sporthemd", "ğŸ½"),
    ("Der Ski", "ğŸ¿"),
    ("Basketball", "ğŸ€"),
    ("Der LÃ¤ufer", "ğŸƒ"),
    ("Surfen", "ğŸ„"),
    ("American Football", "ğŸˆ"),
    ("Rugby", "ğŸ‰"),
    ("Schwimmen", "ğŸŠ"),
    ("Cricket", "ğŸ"),
    ("Hockey", "ğŸ’"),
    ("Das Museum", "ğŸ›ï¸"),
    ("Das BÃ¼ro", "ğŸ¢"),
    ("Das Postamt", "ğŸ£"),
    ("Die Bank", "ğŸ¦"),
    ("Das Hotel", "ğŸ¨"),
    ("Das GeschÃ¤ft", "ğŸ¬"),
    ("Die Fabrik", "ğŸ­"),
    ("Das Etikett", "ğŸ·ï¸"),
    ("BogenschieÃŸen", "ğŸ¹"),
    ("Der BÃ¼ffel", "ğŸƒ"),
    ("Der Leopard", "ğŸ†"),
    ("Der Oktopus", "ğŸ™"),
    ("Die Raupe", "ğŸ›"),
    ("Der Koala", "ğŸ¨"),
    ("Der Pudel", "ğŸ©"),
    ("Das Kamel", "ğŸª"),
    ("Die Augen", "ğŸ‘€"),
    ("Nach unten", "ğŸ‘‡"),
    ("Nach rechts", "ğŸ‘‰"),
    ("Die Faust", "ğŸ‘Š"),
    ("Winken", "ğŸ‘‹"),
    ("Die Krone", "ğŸ‘‘"),
    ("Die Krawatte", "ğŸ‘”"),
    ("Das Portemonnaie", "ğŸ‘›"),
    ("Die Handtasche", "ğŸ‘œ"),
    ("Die Clutch", "ğŸ‘"),
    ("Der Absatz", "ğŸ‘ "),
    ("Der Stiefel", "ğŸ‘¢"),
    ("Blind", "ğŸ‘¨â€ğŸ¦¯"),
    ("Die Familie", "ğŸ‘ª"),
    ("Das Paar", "ğŸ‘«"),
    ("Die HÃ¤schen", "ğŸ‘¯"),
    ("Die Braut", "ğŸ‘°"),
    ("Die Prinzessin", "ğŸ‘¸"),
    ("Der Engel", "ğŸ‘¼"),
    ("Der WÃ¤chter", "ğŸ’‚"),
    ("Der Tanz", "ğŸ’ƒ"),
    ("Der Lippenstift", "ğŸ’„"),
    ("Die Spritze", "ğŸ’‰"),
    ("Die Pille", "ğŸ’Š"),
    ("Der Ring", "ğŸ’"),
    ("Der Diamant", "ğŸ’"),
    ("Der Kuss", "ğŸ’"),
    ("Die Wut", "ğŸ’¢"),
    ("Die Bombe", "ğŸ’£"),
    ("Schlaf", "ğŸ’¤"),
    ("Schwindel", "ğŸ’«"),
    ("Die Kreditkarte", "ğŸ’³"),
    ("Der Dollar", "ğŸ’µ"),
    ("Das Pfund", "ğŸ’·"),
    ("Der Sitz", "ğŸ’º"),
    ("Der Ordner", "ğŸ“"),
    ("Der Kalender", "ğŸ“…"),
    ("Das Lineal", "ğŸ“"),
    ("Das Dreieck", "ğŸ“"),
    ("Das Notizbuch", "ğŸ“”"),
    ("Der Name", "ğŸ“›"),
    ("Das Signal", "ğŸ“¶"),
    ("Das Video", "ğŸ“¹"),
    ("Das Radio", "ğŸ“»"),
    ("Die Kassette", "ğŸ“¼"),
    ("Der Projektor", "ğŸ“½ï¸"),
    ("Die Batterie", "ğŸ”‹"),
    ("Der Stecker", "ğŸ”Œ"),
    ("Das Schloss", "ğŸ”’"),
    ("Der SchraubenschlÃ¼ssel", "ğŸ”§"),
    ("Die Pistole", "ğŸ”«"),
    ("Das Mikroskop", "ğŸ”¬"),
    ("Die Taube", "ğŸ•Šï¸"),
    ("Die Moschee", "ğŸ•Œ"),
    ("Die Synagoge", "ğŸ•"),
    ("Die Kerze", "ğŸ•¯ï¸"),
    ("Der Anzug", "ğŸ•´ï¸"),
    ("Der Pinsel", "ğŸ–Œï¸"),
    ("Der Buntstift", "ğŸ–ï¸"),
    ("Der Mittelfinger", "ğŸ–•"),
    ("Die Computermaus", "ğŸ–±ï¸"),
    ("Die Box", "ğŸ—ƒï¸"),
    ("Der Schrank", "ğŸ—„ï¸"),
    ("Der MÃ¼lleimer", "ğŸ—‘ï¸"),
    ("Der Notizblock", "ğŸ—’ï¸"),
    ("Das Schwert", "ğŸ—¡ï¸"),
    ("Sprechen", "ğŸ—£ï¸"),
    ("Der Turm", "ğŸ—¼"),
    ("Die Freiheitsstatue", "ğŸ—½"),
    ("Die Statue", "ğŸ—¿"),
    ("Verbeugen", "ğŸ™‡"),
    ("Melden", "ğŸ™‹"),
    ("Stirnrunzeln", "ğŸ™"),
    ("Beten", "ğŸ™"),
    ("Die StraÃŸenbahn", "ğŸš‹"),
    ("Die Haltestelle", "ğŸš"),
    ("Der Kleinbus", "ğŸš"),
    ("Der Krankenwagen", "ğŸš‘"),
    ("Das Polizeiauto", "ğŸš“"),
    ("Das Taxi", "ğŸš•"),
    ("Der Lastwagen", "ğŸš›"),
    ("Der Traktor", "ğŸšœ"),
    ("Die Ampel", "ğŸš¦"),
    ("Die Baustelle", "ğŸš§"),
    ("Die Zigarette", "ğŸš¬"),
    ("Kein Abfall", "ğŸš¯"),
    ("Kein Trinkwasser", "ğŸš±"),
    ("Fahrradfahren", "ğŸš´"),
    ("Kinder", "ğŸš¸"),
    ("Frauen", "ğŸšº"),
    ("Das Baby", "ğŸš¼"),
    ("Die Toilette", "ğŸš½"),
    ("Das Bad", "ğŸ›€"),
    ("Das GepÃ¤ck", "ğŸ›„"),
    ("Die GepÃ¤ckaufbewahrung", "ğŸ›…"),
    ("Der Gottesdienst", "ğŸ›"),
    ("Der Tempel", "ğŸ›•"),
    ("Der Aufzug", "ğŸ›—"),
    ("Das Schild", "ğŸ›¡ï¸"),
    ("Das Fass", "ğŸ›¢ï¸"),
    ("Der Roller", "ğŸ›´"),
    ("Das Kanu", "ğŸ›¶"),
    ("Kneifen", "ğŸ¤"),
    ("Rock", "ğŸ¤˜"),
    ("Anruf", "ğŸ¤™"),
    ("Daumen drÃ¼cken", "ğŸ¤"),
    ("Liebe", "ğŸ¤Ÿ"),
    ("Offene HÃ¤nde", "ğŸ¤²"),
    ("Der Prinz", "ğŸ¤´"),
    ("Achselzucken", "ğŸ¤·"),
    ("Jonglieren", "ğŸ¤¹"),
    ("Fechten", "ğŸ¤º"),
    ("Das Tor", "ğŸ¥…"),
    ("Boxen", "ğŸ¥Š"),
    ("Kampfsport", "ğŸ¥‹"),
    ("Der Speck", "ğŸ¥“"),
    ("Der Pfannkuchen", "ğŸ¥"),
    ("Die Tarte", "ğŸ¥§"),
    ("Die Brezel", "ğŸ¥¨"),
    ("Das Steak", "ğŸ¥©"),
    ("Der Kopfsalat", "ğŸ¥¬"),
    ("Der Laborkittel", "ğŸ¥¼"),
    ("Die Schutzbrille", "ğŸ¥½"),
    ("Die Krabbe", "ğŸ¦€"),
    ("Der Skorpion", "ğŸ¦‚"),
    ("Das Einhorn", "ğŸ¦„"),
    ("Der Gorilla", "ğŸ¦"),
    ("Die Eidechse", "ğŸ¦"),
    ("Das Nashorn", "ğŸ¦"),
    ("Der Tintenfisch", "ğŸ¦‘"),
    ("Der Dinosaurier", "ğŸ¦–"),
    ("Das Nilpferd", "ğŸ¦›"),
    ("Der Schwan", "ğŸ¦¢"),
    ("Der Stock", "ğŸ¦¯"),
    ("Der Knochen", "ğŸ¦´"),
    ("Die Sicherheitsweste", "ğŸ¦º"),
    ("Der Roboterarm", "ğŸ¦¾"),
    ("Der Knoblauch", "ğŸ§„"),
    ("Stehen", "ğŸ§"),
    ("Knien", "ğŸ§"),
    ("GehÃ¶rlos", "ğŸ§"),
    ("Die Person", "ğŸ§‘"),
    ("Die Ã¤ltere Person", "ğŸ§“"),
    ("Die Sauna", "ğŸ§–"),
    ("Klettern", "ğŸ§—"),
    ("Die Fee", "ğŸ§š"),
    ("Der Vampir", "ğŸ§›"),
    ("Der Elf", "ğŸ§"),
    ("Das rote Kuvert", "ğŸ§§"),
    ("Der Kompass", "ğŸ§­"),
    ("Der FeuerlÃ¶scher", "ğŸ§¯"),
    ("Die Sicherheitsnadel", "ğŸ§·"),
    ("Der Besen", "ğŸ§¹"),
    ("Der Korb", "ğŸ§º"),
    ("Das Toilettenpapier", "ğŸ§»"),
    ("Der Schwamm", "ğŸ§½"),
    ("Das Pflaster", "ğŸ©¹"),
    ("Das Stethoskop", "ğŸ©º"),
    ("Der Fallschirm", "ğŸª‚"),
    ("Der Rasierer", "ğŸª’"),
    ("Die Axt", "ğŸª“"),
    ("Die Ã–llampe", "ğŸª”"),
    ("Das Banjo", "ğŸª•"),
    ("Die Leiter", "ğŸªœ"),
    ("Der Spiegel", "ğŸª"),
    # DE-only emojis â€” need EN and FR, but for DE they already exist.
    # FR-only emojis â€” need DE and EN:
    ("Die Pommes", "ğŸŸ"),
    ("Der Zylinder", "ğŸ©"),
    ("Das Motorrad", "ğŸï¸"),
    ("Die Landschaft", "ğŸï¸"),
    ("Der Tiger", "ğŸ¯"),
    ("Das Sofa", "ğŸ›‹ï¸"),
    ("Orange", "ğŸŸ "),
    # New emoji: ğŸˆ balloon (was DE-only, now EN gets it fixed)
    # DE already has "Der Luftballon" / "Luftballon" â€” no need to add
    # New: ğŸ”ï¸ mountain (EN fixes â“ â†’ ğŸ”ï¸), DE needs this
    ("Der Berg", "ğŸ”ï¸"),
    # New: ğŸ’ diamond (EN fixes â“ â†’ ğŸ’), DE needs this (added above)
    # New: ğŸ›— elevator/lift (EN fixes â“ â†’ ğŸ›—), DE added above
    # New: ğŸ›‹ï¸ sofa (EN fixes â“ â†’ ğŸ›‹ï¸), DE added above
    # New: ğŸŒ globe (EN fixes â“ â†’ ğŸŒ), DE needs this
    ("Die Erdkugel", "ğŸŒ"),
    # New: ğŸ¤ mate/handshake (EN fixes â“ â†’ ğŸ¤), DE needs this
    ("Der Handschlag", "ğŸ¤"),
    # New: ğŸ¤¼ wrestle (EN fixes â“ â†’ ğŸ¤¼), DE needs this
    ("Ringen", "ğŸ¤¼"),
    # New: ğŸ”† bright (EN fixes â“ â†’ ğŸ”†)
    ("Hell", "ğŸ”†"),
    # New: ğŸ”… dim (EN fixes â“ â†’ ğŸ”…)
    ("Dunkel", "ğŸ”…"),
    # New: ğŸ¨ arts (EN fixes â“ â†’ ğŸ¨)
    ("Die Kunst", "ğŸ¨"),
    # New: ğŸ‹ bamboo (EN fixes â“ â†’ ğŸ‹)
    ("Der Bambus", "ğŸ‹"),
]

# ---------------------------------------------------------------------------
# Step 2b: New English phrases to add (truly new â€” not just emoji fixes)
# ---------------------------------------------------------------------------
NEW_EN = [
    # DE-only emojis:
    ("cookie", "ğŸª"),
    ("cow", "ğŸ„"),
    ("mouse", "ğŸ­"),
    ("t-shirt", "ğŸ‘•"),
    ("baby", "ğŸ‘¶"),
    ("book", "ğŸ“•"),
    # FR-only emojis:
    ("church", "â›ª"),
    ("fries", "ğŸŸ"),
    ("top hat", "ğŸ©"),
    ("motorcycle", "ğŸï¸"),
    ("landscape", "ğŸï¸"),
    ("tiger", "ğŸ¯"),
    # ğŸ›‹ï¸ sofa â€” fixed from â“ to ğŸ›‹ï¸ (not truly new)
    ("orange", "ğŸŸ "),
    # ğŸˆ balloon â€” fixed from â“ to ğŸˆ (not truly new)
    # ğŸ”ï¸ mountain â€” fixed from â“ to ğŸ”ï¸ (not truly new)
    # ğŸŒ globe â€” fixed from â“ to ğŸŒ (not truly new)
]

# ---------------------------------------------------------------------------
# Step 2c: New French phrases to add
# ---------------------------------------------------------------------------
NEW_FR = [
    # DE+EN-not-FR (70 emojis):
    ("La montre", "âŒš"),
    ("Le parapluie", "â˜‚ï¸"),
    ("Le ballon de foot", "âš½"),
    ("La tente", "â›º"),
    ("La main", "âœ‹"),
    ("Le crayon Ã  papier", "âœï¸"),
    ("Le cÅ“ur", "â¤ï¸"),
    ("La neige tombante", "ğŸŒ¨ï¸"),
    ("Le vent qui souffle", "ğŸŒ¬ï¸"),
    ("La fleur", "ğŸŒ¸"),
    ("La rose", "ğŸŒ¹"),
    ("La feuille d'automne", "ğŸ"),
    ("La pastÃ¨que", "ğŸ‰"),
    ("Le hamburger", "ğŸ”"),
    ("La viande", "ğŸ–"),
    ("Les pÃ¢tes", "ğŸ"),
    ("Le beignet", "ğŸ©"),
    ("Le bonbon", "ğŸ­"),
    ("La biÃ¨re", "ğŸº"),
    ("Le cadeau", "ğŸ"),
    ("La guitare", "ğŸ¸"),
    ("Le piano", "ğŸ¹"),
    ("La trompette", "ğŸº"),
    ("Le violon", "ğŸ»"),
    ("Le tennis", "ğŸ¾"),
    ("Le chantier", "ğŸ—ï¸"),
    ("Le crocodile", "ğŸŠ"),
    ("La chÃ¨vre", "ğŸ"),
    ("Le coq", "ğŸ“"),
    ("Le chien", "ğŸ•"),
    ("Le hamster", "ğŸ¹"),
    ("La langue", "ğŸ‘…"),
    ("Le chapeau", "ğŸ‘’"),
    ("Le garÃ§on", "ğŸ‘¦"),
    ("La fille", "ğŸ‘§"),
    ("L'homme", "ğŸ‘¨"),
    ("La femme", "ğŸ‘©"),
    ("La chapelle", "ğŸ’’"),
    ("L'argent", "ğŸ’°"),
    ("L'ordinateur", "ğŸ’»"),
    ("La feuille de papier", "ğŸ“ƒ"),
    ("Le tÃ©lÃ©phone", "ğŸ“±"),
    ("L'appareil photo", "ğŸ“·"),
    ("La tÃ©lÃ©vision", "ğŸ“º"),
    ("Le marteau", "ğŸ”¨"),
    ("Le couteau", "ğŸ”ª"),
    ("Le tÃ©lescope", "ğŸ”­"),
    ("L'horloge", "ğŸ•"),
    ("Le stylo", "ğŸ–Šï¸"),
    ("La fusÃ©e", "ğŸš€"),
    ("L'hÃ©licoptÃ¨re", "ğŸš"),
    ("Le bateau Ã  moteur", "ğŸš¤"),
    ("La batterie de musique", "ğŸ¥"),
    ("La salade", "ğŸ¥—"),
    ("La cacahuÃ¨te", "ğŸ¥œ"),
    ("Le kiwi", "ğŸ¥"),
    ("Le brocoli", "ğŸ¥¦"),
    ("La chauve-souris", "ğŸ¦‡"),
    ("Le requin", "ğŸ¦ˆ"),
    ("Le cerf", "ğŸ¦Œ"),
    ("Le kangourou", "ğŸ¦˜"),
    ("Le paon", "ğŸ¦š"),
    ("Le perroquet", "ğŸ¦œ"),
    ("Le flamant rose", "ğŸ¦©"),
    ("Le pied", "ğŸ¦¶"),
    ("L'oignon", "ğŸ§…"),
    ("La gaufre", "ğŸ§‡"),
    ("L'enfant", "ğŸ§’"),
    ("L'aimant", "ğŸ§²"),
    ("L'ours en peluche", "ğŸ§¸"),
    # EN-only emojis (267):
    ("ZÃ©ro", "0ï¸âƒ£"),
    ("Le clavier", "âŒ¨ï¸"),
    ("Le bonhomme de neige", "â˜ƒï¸"),
    ("La comÃ¨te", "â˜„ï¸"),
    ("Le trÃ¨fle", "â˜˜ï¸"),
    ("La paix", "â˜®ï¸"),
    ("Le cancer", "â™‹"),
    ("L'ancre", "âš“"),
    ("La balance", "âš–ï¸"),
    ("L'engrenage", "âš™ï¸"),
    ("L'atome", "âš›ï¸"),
    ("L'avertissement", "âš ï¸"),
    ("Le cercueil", "âš°ï¸"),
    ("L'orage", "â›ˆï¸"),
    ("Le pic", "â›ï¸"),
    ("La chaÃ®ne", "â›“ï¸"),
    ("Interdit", "â›”"),
    ("Le parasol", "â›±ï¸"),
    ("La fontaine", "â›²"),
    ("Le golf", "â›³"),
    ("Le ferry", "â›´ï¸"),
    ("Le carburant", "â›½"),
    ("Les ciseaux", "âœ‚ï¸"),
    ("La coche", "âœ…"),
    ("La victoire", "âœŒï¸"),
    ("L'Ã©criture", "âœï¸"),
    ("La croix", "âœï¸"),
    ("Les Ã©toiles filantes", "âœ¨"),
    ("La question", "â“"),
    ("Le cercle", "â­•"),
    ("Cool", "ğŸ†’"),
    ("Gratuit", "ğŸ†“"),
    ("Nouveau", "ğŸ†•"),
    ("En haut", "ğŸ†™"),
    ("Service", "ğŸˆ‚ï¸"),
    ("RÃ©servÃ©", "ğŸˆ¯"),
    ("ReÃ§u", "ğŸˆ´"),
    ("Complet", "ğŸˆµ"),
    ("AcceptÃ©", "ğŸ‰‘"),
    ("Le cyclone", "ğŸŒ€"),
    ("L'Ã©clair", "ğŸŒ©ï¸"),
    ("La tornade", "ğŸŒªï¸"),
    ("La chÃ¢taigne", "ğŸŒ°"),
    ("Le cactus", "ğŸŒµ"),
    ("Le piment", "ğŸŒ¶ï¸"),
    ("Le maÃ¯s", "ğŸŒ½"),
    ("Le blÃ©", "ğŸŒ¾"),
    ("L'herbe aromatique", "ğŸŒ¿"),
    ("Le melon", "ğŸˆ"),
    ("L'ananas", "ğŸ"),
    ("La pÃªche", "ğŸ‘"),
    ("La boule de riz", "ğŸ™"),
    ("Le curry", "ğŸ›"),
    ("La crevette", "ğŸ¤"),
    ("Le sorbet", "ğŸ§"),
    ("Le pudding", "ğŸ®"),
    ("Le vin", "ğŸ·"),
    ("Le cocktail", "ğŸ¸"),
    ("Le biberon", "ğŸ¼"),
    ("La fÃªte", "ğŸ‰"),
    ("Les confettis", "ğŸŠ"),
    ("Les poupÃ©es", "ğŸ"),
    ("La carpe", "ğŸ"),
    ("Le carillon", "ğŸ"),
    ("Le microphone", "ğŸ™ï¸"),
    ("Le film", "ğŸï¸"),
    ("La grande roue", "ğŸ¡"),
    ("Les montagnes russes", "ğŸ¢"),
    ("Le cinÃ©ma", "ğŸ¦"),
    ("Le cirque", "ğŸª"),
    ("Le jeu vidÃ©o", "ğŸ®"),
    ("Le billard", "ğŸ±"),
    ("Le dÃ©", "ğŸ²"),
    ("La note de musique", "ğŸµ"),
    ("Le saxophone", "ğŸ·"),
    ("La partition", "ğŸ¼"),
    ("Le maillot de sport", "ğŸ½"),
    ("Le ski", "ğŸ¿"),
    ("Le basketball", "ğŸ€"),
    ("La course Ã  pied", "ğŸƒ"),
    ("Le surf", "ğŸ„"),
    ("Le football amÃ©ricain", "ğŸˆ"),
    ("Le rugby", "ğŸ‰"),
    ("La natation", "ğŸŠ"),
    ("Le cricket", "ğŸ"),
    ("Le hockey", "ğŸ’"),
    ("Le musÃ©e", "ğŸ›ï¸"),
    ("Le bureau", "ğŸ¢"),
    ("La poste", "ğŸ£"),
    ("La banque", "ğŸ¦"),
    ("L'hÃ´tel", "ğŸ¨"),
    ("Le magasin", "ğŸ¬"),
    ("L'usine", "ğŸ­"),
    ("L'Ã©tiquette", "ğŸ·ï¸"),
    ("Le tir Ã  l'arc", "ğŸ¹"),
    ("Le buffle", "ğŸƒ"),
    ("Le lÃ©opard", "ğŸ†"),
    ("La pieuvre", "ğŸ™"),
    ("La chenille", "ğŸ›"),
    ("Le koala", "ğŸ¨"),
    ("Le caniche", "ğŸ©"),
    ("Le chameau", "ğŸª"),
    ("Les yeux", "ğŸ‘€"),
    ("Vers le bas", "ğŸ‘‡"),
    ("Vers la droite", "ğŸ‘‰"),
    ("Le poing", "ğŸ‘Š"),
    ("Le signe de la main", "ğŸ‘‹"),
    ("La couronne", "ğŸ‘‘"),
    ("La cravate", "ğŸ‘”"),
    ("Le porte-monnaie", "ğŸ‘›"),
    ("Le sac Ã  main", "ğŸ‘œ"),
    ("La pochette", "ğŸ‘"),
    ("La chaussure Ã  talon", "ğŸ‘ "),
    ("La botte", "ğŸ‘¢"),
    ("Aveugle", "ğŸ‘¨â€ğŸ¦¯"),
    ("La famille", "ğŸ‘ª"),
    ("Le couple", "ğŸ‘«"),
    ("Les danseurs", "ğŸ‘¯"),
    ("La mariÃ©e", "ğŸ‘°"),
    ("La princesse", "ğŸ‘¸"),
    ("L'ange", "ğŸ‘¼"),
    ("Le garde", "ğŸ’‚"),
    ("La danse", "ğŸ’ƒ"),
    ("Le rouge Ã  lÃ¨vres", "ğŸ’„"),
    ("La seringue", "ğŸ’‰"),
    ("Le comprimÃ©", "ğŸ’Š"),
    ("L'anneau", "ğŸ’"),
    ("Le diamant", "ğŸ’"),
    ("Le baiser", "ğŸ’"),
    ("La colÃ¨re", "ğŸ’¢"),
    ("La bombe", "ğŸ’£"),
    ("Le sommeil", "ğŸ’¤"),
    ("Le vertige", "ğŸ’«"),
    ("La carte de crÃ©dit", "ğŸ’³"),
    ("Le dollar", "ğŸ’µ"),
    ("La livre sterling", "ğŸ’·"),
    ("Le siÃ¨ge", "ğŸ’º"),
    ("Le dossier", "ğŸ“"),
    ("Le calendrier", "ğŸ“…"),
    ("La rÃ¨gle", "ğŸ“"),
    ("L'Ã©querre", "ğŸ“"),
    ("Le carnet", "ğŸ“”"),
    ("Le badge", "ğŸ“›"),
    ("Le signal", "ğŸ“¶"),
    ("La vidÃ©o", "ğŸ“¹"),
    ("La radio", "ğŸ“»"),
    ("La cassette", "ğŸ“¼"),
    ("Le projecteur", "ğŸ“½ï¸"),
    ("La batterie Ã©lectrique", "ğŸ”‹"),
    ("La prise Ã©lectrique", "ğŸ”Œ"),
    ("Le verrou", "ğŸ”’"),
    ("La clÃ© Ã  molette", "ğŸ”§"),
    ("Le pistolet", "ğŸ”«"),
    ("Le microscope", "ğŸ”¬"),
    ("La colombe", "ğŸ•Šï¸"),
    ("La mosquÃ©e", "ğŸ•Œ"),
    ("La synagogue", "ğŸ•"),
    ("La bougie", "ğŸ•¯ï¸"),
    ("Le costume", "ğŸ•´ï¸"),
    ("Le pinceau", "ğŸ–Œï¸"),
    ("Le crayon de couleur", "ğŸ–ï¸"),
    ("Le doigt d'honneur", "ğŸ–•"),
    ("La souris d'ordinateur", "ğŸ–±ï¸"),
    ("La boÃ®te de rangement", "ğŸ—ƒï¸"),
    ("L'armoire", "ğŸ—„ï¸"),
    ("La poubelle", "ğŸ—‘ï¸"),
    ("Le bloc-notes", "ğŸ—’ï¸"),
    ("L'Ã©pÃ©e", "ğŸ—¡ï¸"),
    ("La parole", "ğŸ—£ï¸"),
    ("La tour", "ğŸ—¼"),
    ("La statue de la LibertÃ©", "ğŸ—½"),
    ("La statue", "ğŸ—¿"),
    ("S'incliner", "ğŸ™‡"),
    ("Lever la main", "ğŸ™‹"),
    ("Faire la tÃªte", "ğŸ™"),
    ("Prier", "ğŸ™"),
    ("Le tramway", "ğŸš‹"),
    ("L'arrÃªt de bus", "ğŸš"),
    ("Le minibus", "ğŸš"),
    ("L'ambulance", "ğŸš‘"),
    ("La voiture de police", "ğŸš“"),
    ("Le taxi", "ğŸš•"),
    ("Le camion", "ğŸš›"),
    ("Le tracteur", "ğŸšœ"),
    ("Le feu rouge", "ğŸš¦"),
    ("Le chantier de construction", "ğŸš§"),
    ("La cigarette", "ğŸš¬"),
    ("Pas de dÃ©chets", "ğŸš¯"),
    ("Eau non potable", "ğŸš±"),
    ("Le cyclisme", "ğŸš´"),
    ("Les enfants", "ğŸš¸"),
    ("Les femmes", "ğŸšº"),
    ("Le bÃ©bÃ©", "ğŸš¼"),
    ("Les toilettes", "ğŸš½"),
    ("Le bain", "ğŸ›€"),
    ("Les bagages", "ğŸ›„"),
    ("La consigne Ã  bagages", "ğŸ›…"),
    ("Le lieu de culte", "ğŸ›"),
    ("Le temple", "ğŸ›•"),
    ("L'ascenseur", "ğŸ›—"),
    ("Le bouclier", "ğŸ›¡ï¸"),
    ("Le tonneau", "ğŸ›¢ï¸"),
    ("La trottinette", "ğŸ›´"),
    ("Le canoÃ«", "ğŸ›¶"),
    ("Pincer", "ğŸ¤"),
    ("Rock", "ğŸ¤˜"),
    ("L'appel", "ğŸ¤™"),
    ("Les doigts croisÃ©s", "ğŸ¤"),
    ("L'amour", "ğŸ¤Ÿ"),
    ("Les mains ouvertes", "ğŸ¤²"),
    ("Le prince", "ğŸ¤´"),
    ("Le haussement d'Ã©paules", "ğŸ¤·"),
    ("Le jonglage", "ğŸ¤¹"),
    ("L'escrime", "ğŸ¤º"),
    ("Le but", "ğŸ¥…"),
    ("La boxe", "ğŸ¥Š"),
    ("Les arts martiaux", "ğŸ¥‹"),
    ("Le bacon", "ğŸ¥“"),
    ("La crÃªpe", "ğŸ¥"),
    ("La tarte", "ğŸ¥§"),
    ("Le bretzel", "ğŸ¥¨"),
    ("Le steak", "ğŸ¥©"),
    ("La laitue", "ğŸ¥¬"),
    ("La blouse de laboratoire", "ğŸ¥¼"),
    ("Les lunettes de protection", "ğŸ¥½"),
    ("Le crabe", "ğŸ¦€"),
    ("Le scorpion", "ğŸ¦‚"),
    ("La licorne", "ğŸ¦„"),
    ("Le gorille", "ğŸ¦"),
    ("Le lÃ©zard", "ğŸ¦"),
    ("Le rhinocÃ©ros", "ğŸ¦"),
    ("Le calmar", "ğŸ¦‘"),
    ("Le dinosaure", "ğŸ¦–"),
    ("L'hippopotame", "ğŸ¦›"),
    ("Le cygne", "ğŸ¦¢"),
    ("La canne", "ğŸ¦¯"),
    ("L'os", "ğŸ¦´"),
    ("Le gilet de sÃ©curitÃ©", "ğŸ¦º"),
    ("Le bras robotique", "ğŸ¦¾"),
    ("L'ail", "ğŸ§„"),
    ("Debout", "ğŸ§"),
    ("S'agenouiller", "ğŸ§"),
    ("Sourd", "ğŸ§"),
    ("La personne", "ğŸ§‘"),
    ("La personne Ã¢gÃ©e", "ğŸ§“"),
    ("Le sauna", "ğŸ§–"),
    ("L'escalade", "ğŸ§—"),
    ("La fÃ©e", "ğŸ§š"),
    ("Le vampire", "ğŸ§›"),
    ("L'elfe", "ğŸ§"),
    ("L'enveloppe rouge", "ğŸ§§"),
    ("La boussole", "ğŸ§­"),
    ("L'extincteur", "ğŸ§¯"),
    ("L'Ã©pingle Ã  nourrice", "ğŸ§·"),
    ("Le balai", "ğŸ§¹"),
    ("Le panier", "ğŸ§º"),
    ("Le rouleau de papier", "ğŸ§»"),
    ("L'Ã©ponge", "ğŸ§½"),
    ("Le pansement", "ğŸ©¹"),
    ("Le stÃ©thoscope", "ğŸ©º"),
    ("Le parachute", "ğŸª‚"),
    ("Le rasoir", "ğŸª’"),
    ("La hache", "ğŸª“"),
    ("La lampe Ã  huile", "ğŸª”"),
    ("Le banjo", "ğŸª•"),
    ("L'Ã©chelle", "ğŸªœ"),
    ("Le miroir", "ğŸª"),
    # DE-only emojis:
    ("Le biscuit", "ğŸª"),
    ("Le ballon", "ğŸˆ"),
    ("La vache", "ğŸ„"),
    ("La souris", "ğŸ­"),
    ("Le t-shirt", "ğŸ‘•"),
    ("Le bÃ©bÃ©", "ğŸ‘¶"),
    ("Le livre", "ğŸ“•"),
    # New emoji from EN fix: ğŸ¨ arts, ğŸ‹ bamboo, ğŸ”† bright, ğŸ”… dim, ğŸŒ globe, ğŸ¤ mate, ğŸ”ï¸ mountain, ğŸ¤¼ wrestle
    ("La peinture", "ğŸ¨"),
    ("Le bambou", "ğŸ‹"),
    ("Lumineux", "ğŸ”†"),
    ("Sombre", "ğŸ”…"),
    ("Le globe terrestre", "ğŸŒ"),
    ("La poignÃ©e de main", "ğŸ¤"),
    ("La montagne enneigÃ©e", "ğŸ”ï¸"),
    ("La lutte", "ğŸ¤¼"),
    # FR-only emojis that need DE and EN already listed above for DE and EN
    # But FR already has these, so no need to add FR entries:
    # â›ª L'Ã©glise (already in FR), ğŸŸ Les frites (already in FR), ğŸ© chapeau (already?)
    # Let me check: the analysis shows these ARE in FR but not DE/EN
    # So we don't add them to FR again
]


def fix_emoji_assignments(phrases: list) -> int:
    """Fix â“ emoji assignments in the phrase list. Returns count of fixes."""
    fixed = 0
    for entry in phrases:
        phrase = entry.get("phrase", "")
        if phrase in EMOJI_FIXES and entry.get("emoji") == "â“":
            entry["emoji"] = EMOJI_FIXES[phrase]
            print(f"  fix emoji: '{phrase}' â“ â†’ {EMOJI_FIXES[phrase]}")
            fixed += 1
    return fixed


def add_phrases(phrases: list, new_entries: list, lang: str, category: str = "standard") -> int:
    """Add new phrases with espeak-ng IPA. Returns count of added entries."""
    existing_phrases = {e["phrase"] for e in phrases}
    existing_emojis_per_phrase = {e["phrase"]: e.get("emoji") for e in phrases}

    lang_code = {"de-DE": "de", "fr-FR": "fr", "en-GB": "en-gb"}[lang]
    added = 0

    for phrase, emoji in new_entries:
        if phrase in existing_phrases:
            # Phrase already exists â€” just check emoji is correct
            if existing_emojis_per_phrase.get(phrase) != emoji:
                print(f"  skip (exists, different emoji): '{phrase}'")
            else:
                pass  # Already exists with correct emoji
            continue

        # Generate IPA with espeak-ng
        ipa = get_espeak_ipa(phrase, lang_code)
        if not ipa:
            print(f"  warning: no IPA for '{phrase}' ({lang})")
            ipa = ""

        entry = {
            "phrase": phrase,
            "emoji": emoji,
            "ipas": [{"ipa": f"/{ipa}/" if ipa else "", "category": category}],
        }
        phrases.append(entry)
        existing_phrases.add(phrase)
        print(f"  + [{lang}] {phrase} ({emoji}) â†’ /{ipa}/")
        added += 1

    return added


def main():
    de_path = REPO_ROOT / "phrases-de-DE.yaml"
    en_path = REPO_ROOT / "phrases-en-GB.yaml"
    fr_path = REPO_ROOT / "phrases-fr-FR.yaml"

    print("ğŸ“– Loading phrase files...")
    de = load_yaml(de_path)
    en = load_yaml(en_path)
    fr = load_yaml(fr_path)

    print(f"\nğŸ”§ Fixing â“ emoji assignments in phrases-en-GB.yaml...")
    fixed = fix_emoji_assignments(en)
    print(f"   â†’ fixed {fixed} entries\n")

    print("ğŸ‡©ğŸ‡ª Adding German phrases...")
    n_de = add_phrases(de, NEW_DE, "de-DE")
    print(f"   â†’ added {n_de} entries\n")

    print("ğŸ‡¬ğŸ‡§ Adding English phrases...")
    n_en = add_phrases(en, NEW_EN, "en-GB")
    print(f"   â†’ added {n_en} entries\n")

    print("ğŸ‡«ğŸ‡· Adding French phrases...")
    n_fr = add_phrases(fr, NEW_FR, "fr-FR", category="vowels")
    print(f"   â†’ added {n_fr} entries\n")

    print("ğŸ’¾ Saving files...")
    save_yaml(de_path, de)
    save_yaml(en_path, en)
    save_yaml(fr_path, fr)

    print("âœ… Done!")
    print(f"\nSummary: fixed {fixed} EN emoji, added {n_de} DE, {n_en} EN, {n_fr} FR entries")
    print("Next steps:")
    print("  1. Run: ./run scripts/generate-phrase-audio.sh")
    print("  2. Run: ./run task deploy")


if __name__ == "__main__":
    main()
